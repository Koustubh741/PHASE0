<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BFSI GRC Platform - Functional Archer Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .dashboard-container {
            display: grid;
            grid-template-areas: 
                "header header header header"
                "sidebar main main main"
                "sidebar main main main";
            grid-template-columns: 250px 1fr 1fr 1fr;
            grid-template-rows: 60px 1fr 1fr;
            min-height: 100vh;
            gap: 0;
        }

        /* Header */
        .header {
            grid-area: header;
            background: linear-gradient(90deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #fff;
        }

        .header-title {
            font-size: 18px;
            opacity: 0.9;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background: #0056b3;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #1e7e34;
        }

        .btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #1e3c72;
            font-weight: bold;
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #dc3545;
        }

        .status-dot.connected {
            background: #28a745;
        }

        /* Sidebar */
        .sidebar {
            grid-area: sidebar;
            background: #2c3e50;
            color: white;
            padding: 20px 0;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }

        .nav-item:hover {
            background: rgba(255,255,255,0.1);
            border-left-color: #3498db;
        }

        .nav-item.active {
            background: rgba(52, 152, 219, 0.2);
            border-left-color: #3498db;
        }

        .nav-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Main Content */
        .main-content {
            grid-area: main;
            padding: 20px;
            background: #f8f9fa;
            overflow-y: auto;
        }

        .content-header {
            margin-bottom: 30px;
        }

        .content-title {
            font-size: 28px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .content-subtitle {
            color: #6c757d;
            font-size: 16px;
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .dashboard-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .dashboard-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
        }

        .card-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
        }

        .metric-value {
            font-size: 32px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .metric-label {
            color: #6c757d;
            font-size: 14px;
        }

        .metric-change {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
            margin-top: 10px;
        }

        .metric-change.positive {
            color: #28a745;
        }

        .metric-change.negative {
            color: #dc3545;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Policy Toggle Section */
        .policy-section {
            background: white;
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .policy-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .policy-title {
            font-size: 20px;
            font-weight: 600;
            color: #2c3e50;
        }

        .policy-toggle-container {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
            background: #dc3545;
            border-radius: 15px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .toggle-switch.active {
            background: #28a745;
        }

        .toggle-slider {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(30px);
        }

        .policy-dropdown {
            width: 100%;
            padding: 12px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-size: 14px;
            background: white;
            margin-bottom: 15px;
        }

        .policy-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .policy-card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
            transition: all 0.3s ease;
        }

        .policy-card:hover {
            background: #e9ecef;
            border-color: #adb5bd;
        }

        .policy-card.applied {
            background: #d4edda;
            border-color: #28a745;
        }

        .policy-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .policy-name {
            font-weight: 600;
            color: #2c3e50;
        }

        .policy-category {
            background: #007bff;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
        }

        .policy-description {
            color: #6c757d;
            font-size: 13px;
            margin-bottom: 10px;
            line-height: 1.4;
        }

        .compliance-level {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .compliance-level.critical {
            background: #f8d7da;
            color: #721c24;
        }

        .compliance-level.high {
            background: #fff3cd;
            color: #856404;
        }

        .compliance-level.medium {
            background: #d1ecf1;
            color: #0c5460;
        }

        /* Alerts Section */
        .alerts-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .alert-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border-left: 4px solid #007bff;
            background: #f8f9fa;
            border-radius: 6px;
            margin-bottom: 10px;
        }

        .alert-item.critical {
            border-left-color: #dc3545;
            background: #f8d7da;
        }

        .alert-item.warning {
            border-left-color: #ffc107;
            background: #fff3cd;
        }

        .alert-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .alert-content {
            flex: 1;
        }

        .alert-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .alert-description {
            color: #6c757d;
            font-size: 14px;
        }

        /* Error Messages */
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            border: 1px solid #f5c6cb;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            border: 1px solid #c3e6cb;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .dashboard-container {
                grid-template-areas: 
                    "header"
                    "main";
                grid-template-columns: 1fr;
                grid-template-rows: 60px 1fr;
            }
            
            .sidebar {
                display: none;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .dashboard-card {
            animation: fadeIn 0.6s ease-out;
        }

        .dashboard-card:nth-child(1) { animation-delay: 0.1s; }
        .dashboard-card:nth-child(2) { animation-delay: 0.2s; }
        .dashboard-card:nth-child(3) { animation-delay: 0.3s; }
        .dashboard-card:nth-child(4) { animation-delay: 0.4s; }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <div class="logo">🏦 BFSI GRC</div>
                <div class="header-title">Governance, Risk & Compliance Platform</div>
            </div>
            <div class="header-right">
                <div class="connection-status">
                    <div class="status-dot" id="connectionStatus"></div>
                    <span id="connectionText">Connecting...</span>
                </div>
                <div class="header-actions">
                    <button class="btn btn-primary" onclick="refreshData()">Refresh</button>
                    <button class="btn btn-success" onclick="exportReport()">Export Report</button>
                </div>
                <div class="user-info">
                    <div class="user-avatar">JD</div>
                    <span>John Doe</span>
                </div>
            </div>
        </header>

        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="nav-item active">
                <div class="nav-icon">📊</div>
                <span>Dashboard</span>
            </div>
            <div class="nav-item">
                <div class="nav-icon">🛡️</div>
                <span>Risk Management</span>
            </div>
            <div class="nav-item">
                <div class="nav-icon">📋</div>
                <span>Compliance</span>
            </div>
            <div class="nav-item">
                <div class="nav-icon">📄</div>
                <span>Policies</span>
            </div>
            <div class="nav-item">
                <div class="nav-icon">🔍</div>
                <span>Audits</span>
            </div>
            <div class="nav-item">
                <div class="nav-icon">📈</div>
                <span>Reports</span>
            </div>
            <div class="nav-item">
                <div class="nav-icon">⚙️</div>
                <span>Settings</span>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <div class="content-header">
                <h1 class="content-title">BFSI GRC Dashboard</h1>
                <p class="content-subtitle">Real-time monitoring and compliance management for Banking, Financial Services & Insurance</p>
            </div>

            <!-- Key Metrics -->
            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3 class="card-title">Risk Score</h3>
                        <div class="card-icon" style="background: #dc3545;">⚠️</div>
                    </div>
                    <div class="metric-value" id="riskScore">
                        <div class="loading"></div>
                    </div>
                    <div class="metric-label">Overall Risk Level</div>
                    <div class="metric-change" id="riskChange">
                        <span>↗</span>
                        <span>Loading...</span>
                    </div>
                </div>

                <div class="dashboard-card">
                    <div class="card-header">
                        <h3 class="card-title">Compliance Score</h3>
                        <div class="card-icon" style="background: #28a745;">✅</div>
                    </div>
                    <div class="metric-value" id="complianceScore">
                        <div class="loading"></div>
                    </div>
                    <div class="metric-label">Regulatory Compliance</div>
                    <div class="metric-change" id="complianceChange">
                        <span>↗</span>
                        <span>Loading...</span>
                    </div>
                </div>

                <div class="dashboard-card">
                    <div class="card-header">
                        <h3 class="card-title">Active Policies</h3>
                        <div class="card-icon" style="background: #007bff;">📋</div>
                    </div>
                    <div class="metric-value" id="activePolicies">
                        <div class="loading"></div>
                    </div>
                    <div class="metric-label">Policies in Effect</div>
                    <div class="metric-change" id="policiesChange">
                        <span>→</span>
                        <span>Loading...</span>
                    </div>
                </div>

                <div class="dashboard-card">
                    <div class="card-header">
                        <h3 class="card-title">Open Alerts</h3>
                        <div class="card-icon" style="background: #ffc107;">🚨</div>
                    </div>
                    <div class="metric-value" id="openAlerts">
                        <div class="loading"></div>
                    </div>
                    <div class="metric-label">Requiring Attention</div>
                    <div class="metric-change" id="alertsChange">
                        <span>↘</span>
                        <span>Loading...</span>
                    </div>
                </div>
            </div>

            <!-- Policy Management Section -->
            <div class="policy-section">
                <div class="policy-header">
                    <h2 class="policy-title">Industry Standard Policy Management</h2>
                    <div class="status-indicator active">
                        <div class="status-dot"></div>
                        <span>System Active</span>
                    </div>
                </div>

                <div class="policy-toggle-container">
                    <div class="toggle-switch" id="policyToggle" onclick="togglePolicy()">
                        <div class="toggle-slider"></div>
                    </div>
                    <span id="toggleStatus">Industry Standard Policy Integration: <strong>Disabled</strong></span>
                </div>

                <div id="policySelection" style="display: none;">
                    <label for="policySelect">Select Policy to Apply:</label>
                    <select id="policySelect" class="policy-dropdown" onchange="selectPolicy()">
                        <option value="">Choose a policy...</option>
                        <option value="basel_iii">Basel III Capital Requirements</option>
                        <option value="sox">Sarbanes-Oxley Act (SOX)</option>
                        <option value="pci_dss">PCI DSS</option>
                        <option value="aml_kyc">AML/KYC Requirements</option>
                        <option value="gdpr">GDPR Compliance</option>
                        <option value="ifrs">IFRS Standards</option>
                    </select>
                </div>

                <div id="selectedPolicy" style="display: none; margin-top: 15px; padding: 15px; background: #d4edda; border-radius: 6px; border-left: 4px solid #28a745;">
                    <strong>✅ Policy Applied:</strong> <span id="appliedPolicyName"></span>
                    <br><small>This policy is now active and will be applied to all BFSI operations through the platform workflow.</small>
                </div>

                <div class="policy-grid" id="policyGrid">
                    <!-- Policy cards will be populated dynamically -->
                </div>
            </div>

            <!-- Alerts Section -->
            <div class="alerts-section">
                <h3 class="chart-title">Recent Alerts & Notifications</h3>
                <div id="alertsContainer">
                    <!-- Alerts will be populated dynamically -->
                </div>
            </div>
        </main>
    </div>

    <script>
        // API Configuration
        const API_BASE_URL = 'http://127.0.0.1:8000';
        let isConnected = false;
        let currentPolicies = [];

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🏦 BFSI Functional Dashboard Initializing...');
            initializeDashboard();
        });

        // Initialize dashboard components
        async function initializeDashboard() {
            try {
                // Test backend connection
                await testBackendConnection();
                
                // Load initial data
                await loadDashboardData();
                
                // Set up real-time updates
                setupRealTimeUpdates();
                
                // Initialize policy management
                initializePolicyManagement();
                
                console.log('✅ Dashboard initialized successfully');
            } catch (error) {
                console.error('❌ Dashboard initialization failed:', error);
                showError('Failed to initialize dashboard. Please check backend connection.');
            }
        }

        // Test backend connection
        async function testBackendConnection() {
            try {
                const response = await fetch(`${API_BASE_URL}/grc/industry/bfsi/status`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    isConnected = true;
                    updateConnectionStatus(true);
                    console.log('✅ Backend connection established');
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                isConnected = false;
                updateConnectionStatus(false);
                console.warn('⚠️ Backend connection failed:', error.message);
                // Continue with mock data for demonstration
            }
        }

        // Update connection status UI
        function updateConnectionStatus(connected) {
            const statusDot = document.getElementById('connectionStatus');
            const statusText = document.getElementById('connectionText');
            
            if (connected) {
                statusDot.classList.add('connected');
                statusText.textContent = 'Connected';
            } else {
                statusDot.classList.remove('connected');
                statusText.textContent = 'Offline';
            }
        }

        // Load dashboard data
        async function loadDashboardData() {
            try {
                if (isConnected) {
                    await loadRealData();
                } else {
                    await loadMockData();
                }
            } catch (error) {
                console.error('Error loading dashboard data:', error);
                await loadMockData(); // Fallback to mock data
            }
        }

        // Load real data from backend
        async function loadRealData() {
            try {
                // Load metrics
                const metricsResponse = await fetch(`${API_BASE_URL}/grc/industry/bfsi/status`);
                const metrics = await metricsResponse.json();
                
                updateMetrics(metrics);
                
                // Load policies
                const policiesResponse = await fetch(`${API_BASE_URL}/grc/industry/bfsi/policies`);
                const policies = await policiesResponse.json();
                
                updatePolicies(policies);
                
                // Load alerts
                const alertsResponse = await fetch(`${API_BASE_URL}/grc/industry/bfsi/alerts`);
                const alerts = await alertsResponse.json();
                
                updateAlerts(alerts);
                
            } catch (error) {
                console.error('Error loading real data:', error);
                throw error;
            }
        }

        // Load mock data for demonstration
        async function loadMockData() {
            console.log('📊 Loading mock data for demonstration...');
            
            // Simulate API delay
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            const mockMetrics = {
                risk_score: 72,
                compliance_score: 94,
                active_policies: 23,
                open_alerts: 7
            };
            
            updateMetrics(mockMetrics);
            updatePolicies([]);
            updateAlerts([]);
        }

        // Update metrics display
        function updateMetrics(metrics) {
            document.getElementById('riskScore').textContent = `${metrics.risk_score}%`;
            document.getElementById('complianceScore').textContent = `${metrics.compliance_score}%`;
            document.getElementById('activePolicies').textContent = metrics.active_policies;
            document.getElementById('openAlerts').textContent = metrics.open_alerts;
            
            // Update change indicators
            document.getElementById('riskChange').innerHTML = '<span>↗</span><span>2.1% from last month</span>';
            document.getElementById('complianceChange').innerHTML = '<span>↗</span><span>1.5% from last month</span>';
            document.getElementById('policiesChange').innerHTML = '<span>→</span><span>No change</span>';
            document.getElementById('alertsChange').innerHTML = '<span>↘</span><span>3 fewer than last week</span>';
        }

        // Update policies display
        function updatePolicies(policies) {
            currentPolicies = policies;
            const policyGrid = document.getElementById('policyGrid');
            
            const policyData = [
                {
                    id: 'basel_iii',
                    name: 'Basel III',
                    category: 'Capital Adequacy',
                    description: 'International regulatory framework for bank capital adequacy, leverage ratios, and liquidity requirements.',
                    level: 'critical',
                    applied: policies.some(p => p.policy_type === 'basel_iii')
                },
                {
                    id: 'sox',
                    name: 'Sarbanes-Oxley',
                    category: 'Governance',
                    description: 'Corporate governance and financial disclosure requirements with internal controls and audit requirements.',
                    level: 'critical',
                    applied: policies.some(p => p.policy_type === 'sox')
                },
                {
                    id: 'pci_dss',
                    name: 'PCI DSS',
                    category: 'Data Security',
                    description: 'Payment Card Industry Data Security Standard for cardholder data protection and network security.',
                    level: 'high',
                    applied: policies.some(p => p.policy_type === 'pci_dss')
                },
                {
                    id: 'aml_kyc',
                    name: 'AML/KYC',
                    category: 'Anti-Money Laundering',
                    description: 'Anti-Money Laundering and Know Your Customer regulations with transaction monitoring.',
                    level: 'critical',
                    applied: policies.some(p => p.policy_type === 'aml_kyc')
                },
                {
                    id: 'gdpr',
                    name: 'GDPR',
                    category: 'Data Privacy',
                    description: 'General Data Protection Regulation for EU customers with data protection and consent management.',
                    level: 'high',
                    applied: policies.some(p => p.policy_type === 'gdpr')
                },
                {
                    id: 'ifrs',
                    name: 'IFRS',
                    category: 'Financial Reporting',
                    description: 'International Financial Reporting Standards for standardized financial reporting and disclosure.',
                    level: 'high',
                    applied: policies.some(p => p.policy_type === 'ifrs')
                }
            ];
            
            policyGrid.innerHTML = policyData.map(policy => `
                <div class="policy-card ${policy.applied ? 'applied' : ''}" data-policy-id="${policy.id}">
                    <div class="policy-card-header">
                        <span class="policy-name">${policy.name}</span>
                        <span class="policy-category">${policy.category}</span>
                    </div>
                    <div class="policy-description">${policy.description}</div>
                    <span class="compliance-level ${policy.level}">${policy.level}</span>
                </div>
            `).join('');
        }

        // Update alerts display
        function updateAlerts(alerts) {
            const alertsContainer = document.getElementById('alertsContainer');
            
            if (alerts.length === 0) {
                // Show mock alerts for demonstration
                const mockAlerts = [
                    {
                        type: 'critical',
                        title: 'High Risk Alert - Credit Exposure',
                        description: 'Credit risk exposure has exceeded threshold limits. Immediate review required.',
                        icon: '!'
                    },
                    {
                        type: 'warning',
                        title: 'Compliance Review Due',
                        description: 'Basel III compliance review is due in 5 days. Please schedule assessment.',
                        icon: '⚠'
                    },
                    {
                        type: 'info',
                        title: 'Policy Update Available',
                        description: 'New AML/KYC policy guidelines have been released. Review and update required.',
                        icon: 'ℹ'
                    }
                ];
                
                alertsContainer.innerHTML = mockAlerts.map(alert => `
                    <div class="alert-item ${alert.type}">
                        <div class="alert-icon" style="background: ${alert.type === 'critical' ? '#dc3545' : alert.type === 'warning' ? '#ffc107' : '#007bff'};">${alert.icon}</div>
                        <div class="alert-content">
                            <div class="alert-title">${alert.title}</div>
                            <div class="alert-description">${alert.description}</div>
                        </div>
                    </div>
                `).join('');
            } else {
                alertsContainer.innerHTML = alerts.map(alert => `
                    <div class="alert-item ${alert.severity}">
                        <div class="alert-icon" style="background: ${alert.severity === 'critical' ? '#dc3545' : alert.severity === 'warning' ? '#ffc107' : '#007bff'};">${alert.icon || '!'}</div>
                        <div class="alert-content">
                            <div class="alert-title">${alert.title}</div>
                            <div class="alert-description">${alert.description}</div>
                        </div>
                    </div>
                `).join('');
            }
        }

        // Initialize policy management
        function initializePolicyManagement() {
            // Load available policy standards
            loadPolicyStandards();
        }

        // Load policy standards from backend
        async function loadPolicyStandards() {
            try {
                if (isConnected) {
                    const response = await fetch(`${API_BASE_URL}/grc/industry/bfsi/policy-standards`);
                    const standards = await response.json();
                    console.log('📋 Policy standards loaded:', standards);
                }
            } catch (error) {
                console.warn('⚠️ Could not load policy standards:', error);
            }
        }

        // Toggle policy integration
        function togglePolicy() {
            const toggle = document.getElementById('policyToggle');
            const status = document.getElementById('toggleStatus');
            const selection = document.getElementById('policySelection');
            
            toggle.classList.toggle('active');
            
            if (toggle.classList.contains('active')) {
                status.innerHTML = 'Industry Standard Policy Integration: <strong style="color: #28a745;">Enabled</strong>';
                selection.style.display = 'block';
            } else {
                status.innerHTML = 'Industry Standard Policy Integration: <strong style="color: #dc3545;">Disabled</strong>';
                selection.style.display = 'none';
                document.getElementById('selectedPolicy').style.display = 'none';
            }
        }

        // Select and apply policy
        async function selectPolicy() {
            const select = document.getElementById('policySelect');
            const selectedDiv = document.getElementById('selectedPolicy');
            const policyName = document.getElementById('appliedPolicyName');
            
            if (select.value) {
                const policies = {
                    'basel_iii': 'Basel III Capital Requirements',
                    'sox': 'Sarbanes-Oxley Act (SOX)',
                    'pci_dss': 'PCI DSS',
                    'aml_kyc': 'AML/KYC Requirements',
                    'gdpr': 'GDPR Compliance',
                    'ifrs': 'IFRS Standards'
                };
                
                policyName.textContent = policies[select.value];
                selectedDiv.style.display = 'block';
                
                try {
                    if (isConnected) {
                        // Apply policy via backend API
                        const response = await fetch(`${API_BASE_URL}/grc/industry/bfsi/policies`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                policy_type: select.value,
                                policy_name: policies[select.value],
                                industry_standard: true
                            })
                        });
                        
                        if (response.ok) {
                            const result = await response.json();
                            console.log('✅ Policy applied successfully:', result);
                            showSuccess(`Policy "${policies[select.value]}" applied successfully!`);
                            
                            // Update policy cards
                            updatePolicyCard(select.value, true);
                            
                            // Refresh dashboard data
                            await loadDashboardData();
                        } else {
                            throw new Error(`HTTP ${response.status}`);
                        }
                    } else {
                        // Simulate policy application
                        console.log('📋 Applying policy:', select.value);
                        showSuccess(`Policy "${policies[select.value]}" applied successfully! (Demo Mode)`);
                        updatePolicyCard(select.value, true);
                    }
                } catch (error) {
                    console.error('❌ Failed to apply policy:', error);
                    showError('Failed to apply policy. Please try again.');
                }
            } else {
                selectedDiv.style.display = 'none';
            }
        }

        // Update policy card visual state
        function updatePolicyCard(policyId, applied) {
            const policyCard = document.querySelector(`[data-policy-id="${policyId}"]`);
            if (policyCard) {
                if (applied) {
                    policyCard.classList.add('applied');
                } else {
                    policyCard.classList.remove('applied');
                }
            }
        }

        // Set up real-time updates
        function setupRealTimeUpdates() {
            // Update metrics every 30 seconds
            setInterval(async () => {
                if (isConnected) {
                    try {
                        await loadDashboardData();
                    } catch (error) {
                        console.warn('⚠️ Real-time update failed:', error);
                    }
                }
            }, 30000);
        }

        // Refresh data
        async function refreshData() {
            console.log('🔄 Refreshing dashboard data...');
            try {
                await loadDashboardData();
                showSuccess('Dashboard data refreshed successfully!');
            } catch (error) {
                console.error('❌ Refresh failed:', error);
                showError('Failed to refresh data. Please try again.');
            }
        }

        // Export report
        async function exportReport() {
            console.log('📊 Exporting report...');
            try {
                if (isConnected) {
                    // Export via backend API
                    const response = await fetch(`${API_BASE_URL}/grc/industry/bfsi/export-report`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    if (response.ok) {
                        const blob = await response.blob();
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = 'bfsi-grc-report.pdf';
                        a.click();
                        showSuccess('Report exported successfully!');
                    } else {
                        throw new Error(`HTTP ${response.status}`);
                    }
                } else {
                    // Simulate export
                    showSuccess('Report export initiated! (Demo Mode)');
                }
            } catch (error) {
                console.error('❌ Export failed:', error);
                showError('Failed to export report. Please try again.');
            }
        }

        // Show success message
        function showSuccess(message) {
            const successDiv = document.createElement('div');
            successDiv.className = 'success-message';
            successDiv.textContent = message;
            document.querySelector('.main-content').insertBefore(successDiv, document.querySelector('.dashboard-grid'));
            
            setTimeout(() => {
                successDiv.remove();
            }, 5000);
        }

        // Show error message
        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.textContent = message;
            document.querySelector('.main-content').insertBefore(errorDiv, document.querySelector('.dashboard-grid'));
            
            setTimeout(() => {
                errorDiv.remove();
            }, 5000);
        }

        // Add click handlers for navigation
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function() {
                document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                this.classList.add('active');
            });
        });
    </script>
</body>
</html>
